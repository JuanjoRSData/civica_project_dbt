version: 2

models:
  - name: stg_orders
    description: Datos de los pedidosrealizados.
    docs:
      node_color: "#3498db"
    columns:
    - name: orders_id
      description: Identificador único formado por el haasheo del order_id que recibimos.
      tests:
        - not_null
        - unique
    - name: shipping_service_id
      description: Clave foranea a la tabla shipping_services.
    - name: shipping_cost
      description: Coste del pedido.
    - name: address_id
      description: Dirección a la que se envia el pedido.
    - name: shipping_cost
      description: Coste del pedido.
    - name: created_at
      description: Fecha de creación.
    - name: date_created_at
      description: Fecha de creación casteada a formato 'dd/mm/yy' para poder relacionarla con la tabla dates.
    - name: promo_id
      description: Clave foranea a la tabla promos
    - name: estimated_delivery_at
      description: Tiempo estimado de entrega
    - name: date_estimated_delivery_at
      description: Tiempo estimado de entrega casteada a formato 'dd/mm/yy' para poder relacionarla con la tabla dates.  
    - name: order_cost
      description: Precio del pedido.      
    - name: user_id
      description: Clave foranea a la tabla users. 
    - name: order_total
      description: Precio del pedido sumandole el coste de envio.   
    - name: delivered_at
      description: Fecha de el momento de salida del envio.  
    - name: status
      description: Tipo de evento [delivered, preparing, shipped].  
    - name: status
      description: Tipo de evento [delivered, preparing, shipped].  
    - name: _fivetran_deleted
      description: Fecha de borrado.
    - name: date_load
      description: Fecha de carga desde fivetran.

  - name: stg_events
    description: Datos de eventos referentes a la página web.
    docs:
      node_color: "#3498db"
    columns:
    - name: event_id
      description: Identificador único formado por el haasheo del event_id que recibimos.
      tests:
        - not_null
        - unique
    - name: page_url
      description: Página donde ocurren los eventos.
    - name: event_type
      description:  Tipo de evento [checkout, package_shipped, add_to_cart, page_view].
    - name: user_id
      description: Clave foranea que referencia la tabla users.
    - name: session_id
      description: Identificador único de session.
    - name: created_at
      description: Fecha de creación.
    - name: order_id
      description: Clave foranea que referencia la tabla orders.
    - name: _fivetran_deleted
      description: Fecha de borrado.
    - name: date_load
      description: Fecha de carga desde fivetran.

  - name: stg_users
    description: Datos de usuario.
    docs:
      node_color: "#3498db"
    columns:
    - name: user_id
      description: Identificador único formado por el haasheo del user_id que recibimos.
      tests:
        - not_null
        - unique
    - name: updated_at
      description: Fecha de la actualización.
    - name: address_id
      description: Clave foranea a la tabla addresses.
    - name: last_name
      description: Apellido del usuario.
    - name: created_at
      description: Fecha de cración.
    - name: phone_number
      description: Teléfono de usuario.
    - name: first_name
      description: Nombre usuario.
    - name: email
      description: Correo electrónico del usuario.
    - name: _fivetran_deleted
      description: Fecha de borrado.
    - name: date_load
      description: Fecha de carga desde fivetran.

  - name: stg_shipping_service
    description: Datos del la compañia de transportes.
    docs:
      node_color: "#3498db"
    columns:
    - name: shipping_services_id
      description: Identificador único formado por el haasheo del shipping_service de orders.
      tests:
        - not_null
        - unique
    - name: shipping_company_name
      description: Nombre de la compañia de transportes

  - name: stg_inventories
    description: Contiene los datos de stock de cada producto junto a la fecha haciendo un snapshop para mantener un historico.
    docs:
      node_color: "#3498db"
    columns:
      - name: inventory_id
        description: Identificador único formado por el product_id y la fecha de carga.
        tests:
          - not_null
          - unique
      - name: product_stock
        description: CAntidad de producto en almacen
      - name: actual_date
        description: Fecha de carga y clave foranea para relacionarse con date

  - name: stg_products
    description: Contiene los datos de cada producto
    columns:
      - name: product_id
        description: Identificador unico hashedo
        tests:
          - not_null
          - unique
      - name: price
        description: Precio del producto en ¿dolares?
      - name: inventory
        description: Cantidad del producto en stock
      - name: _fivetran_deleted
        description: Valor booleano que define si fue borrado o no
      - name: date_load
        description: Fecha en la que se carga el dato
  
  - name: stg_addresses
    description: Contiene los datos de las direcciones (addresses)

    columns:
      - name: address_id
        description: Identificador unico hashedo
        tests:
          - not_null
          - unique
      - name: zipcode
        description: Codigo postal
      - name: discount
        description: Descuento a aplicar sobre esta promocion en porcentaje
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
      - name: _fivetran_deleted
        description: Valor booleano que define si fue borrado o no
      - name: date_load
        description: Fecha en la que se carga el dato

  - name: stg_promos
    description: Contiene los datos de las promociones que se aplicarán a las orders
    docs:
      node_color: "#3498db"
    columns:
      - name: promo_id
        description: Es el nombre de la promo hashado
        tests:
          - not_null
          - unique
      - name: name
        description: Nombre de la promocion
        tests:
          - not_null
          - unique
      - name: discount
        description: Descuento a aplicar sobre esta promocion en porcentaje
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
      - name: _fivetran_deleted
        description: Valor booleano que define si fue borrado o no
      - name: date_load
        description: fecha en la que se carga el dato

  - name: stg_dates
    description: Dimensión de tiempo/calendario generada a partir de date_spine
    docs:
      node_color: "#3498db"
    columns:
      - name: date_id
        description: Fecha en formato YYYY-MM-DD que se utilizará como identificador unico
        tests:
          - not_null
          - unique
      - name: fecha
        description: Fecha en formato YYYY-MM-DD
        tests:
          - not_null
          - unique
          
      - name: dia
        description: Día del mes (1-31)

      - name: mes
        description: Número del mes (1-12)
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12] 

      - name: nombre_mes
        description: Nombre completo del mes (January-December)
      
      - name: anio
        description: Año numérico (YYYY)
        tests:
          - not_null

      # Semanas
      - name: semana_del_anio
        description: Número de semana según estándar ISO (1-53)
        tests:
          - not_null
          - accepted_values:
              values: "{{ range(1, 54) | list }}"

      # Trimestres
      - name: trimestre
        description: Trimestre del año (1-4)
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4]
      
      # Días de semana
      - name: dia_semana_numero
        description: Número del día de semana (1=Lunes-0=Domingo)
      
      - name: nombre_dia
        description: Nombre del día de semana (Monday-Sunday)

      - name: tipo_dia
        description: Indica si es fin de semana (sábado o domingo)
        tests:
          - accepted_values:
              values: [true, false]
